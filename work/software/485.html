<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RS485网页配置 | 夜枫林</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="夜枫林的个人文档">
    
    <link rel="preload" href="/assets/css/0.styles.9a2d1e15.css" as="style"><link rel="preload" href="/assets/js/app.d1f89baa.js" as="script"><link rel="preload" href="/assets/js/2.33a11089.js" as="script"><link rel="preload" href="/assets/js/1.44c9c021.js" as="script"><link rel="preload" href="/assets/js/18.60874fbd.js" as="script"><link rel="prefetch" href="/assets/js/10.db1dbbce.js"><link rel="prefetch" href="/assets/js/100.92896e47.js"><link rel="prefetch" href="/assets/js/101.15a97113.js"><link rel="prefetch" href="/assets/js/102.5dd9a376.js"><link rel="prefetch" href="/assets/js/103.03a34e86.js"><link rel="prefetch" href="/assets/js/104.28f39b6f.js"><link rel="prefetch" href="/assets/js/105.3f5a4458.js"><link rel="prefetch" href="/assets/js/106.d2c58251.js"><link rel="prefetch" href="/assets/js/107.cab8ff32.js"><link rel="prefetch" href="/assets/js/108.89deb882.js"><link rel="prefetch" href="/assets/js/109.99d9d6c4.js"><link rel="prefetch" href="/assets/js/11.0ee27408.js"><link rel="prefetch" href="/assets/js/110.2f4fbe9c.js"><link rel="prefetch" href="/assets/js/111.7b3cb5e8.js"><link rel="prefetch" href="/assets/js/112.45995b29.js"><link rel="prefetch" href="/assets/js/113.63cf8460.js"><link rel="prefetch" href="/assets/js/114.9b17848e.js"><link rel="prefetch" href="/assets/js/115.cbbc90d8.js"><link rel="prefetch" href="/assets/js/116.13287e92.js"><link rel="prefetch" href="/assets/js/117.5fa07f7e.js"><link rel="prefetch" href="/assets/js/118.fd2d4a15.js"><link rel="prefetch" href="/assets/js/119.0747eeb1.js"><link rel="prefetch" href="/assets/js/12.7c2d7685.js"><link rel="prefetch" href="/assets/js/13.a8d4c2ca.js"><link rel="prefetch" href="/assets/js/14.03e75a0e.js"><link rel="prefetch" href="/assets/js/15.4592ab82.js"><link rel="prefetch" href="/assets/js/16.2b4e448c.js"><link rel="prefetch" href="/assets/js/17.8a099cbe.js"><link rel="prefetch" href="/assets/js/19.ce8b1490.js"><link rel="prefetch" href="/assets/js/20.a25f7b26.js"><link rel="prefetch" href="/assets/js/21.ea1108ac.js"><link rel="prefetch" href="/assets/js/22.749da2ea.js"><link rel="prefetch" href="/assets/js/23.b4cce890.js"><link rel="prefetch" href="/assets/js/24.40f3dc08.js"><link rel="prefetch" href="/assets/js/25.366725a2.js"><link rel="prefetch" href="/assets/js/26.5922ff9b.js"><link rel="prefetch" href="/assets/js/27.98018560.js"><link rel="prefetch" href="/assets/js/28.4f5d17d4.js"><link rel="prefetch" href="/assets/js/29.84836c8d.js"><link rel="prefetch" href="/assets/js/3.86972335.js"><link rel="prefetch" href="/assets/js/30.3368f025.js"><link rel="prefetch" href="/assets/js/31.a044568e.js"><link rel="prefetch" href="/assets/js/32.246fdf0a.js"><link rel="prefetch" href="/assets/js/33.c71e3175.js"><link rel="prefetch" href="/assets/js/34.94a182e2.js"><link rel="prefetch" href="/assets/js/35.9ca5d571.js"><link rel="prefetch" href="/assets/js/36.2ac09003.js"><link rel="prefetch" href="/assets/js/37.40c41749.js"><link rel="prefetch" href="/assets/js/38.3f57616b.js"><link rel="prefetch" href="/assets/js/39.9aacf31f.js"><link rel="prefetch" href="/assets/js/4.c455e15d.js"><link rel="prefetch" href="/assets/js/40.b81d93cc.js"><link rel="prefetch" href="/assets/js/41.5b78978d.js"><link rel="prefetch" href="/assets/js/42.100fc14d.js"><link rel="prefetch" href="/assets/js/43.21618f2f.js"><link rel="prefetch" href="/assets/js/44.17bde610.js"><link rel="prefetch" href="/assets/js/45.226c1926.js"><link rel="prefetch" href="/assets/js/46.fb88906c.js"><link rel="prefetch" href="/assets/js/47.75e60a9b.js"><link rel="prefetch" href="/assets/js/48.b58a5bc7.js"><link rel="prefetch" href="/assets/js/49.b7229731.js"><link rel="prefetch" href="/assets/js/5.e71a345a.js"><link rel="prefetch" href="/assets/js/50.fed3ee3d.js"><link rel="prefetch" href="/assets/js/51.1b4857c7.js"><link rel="prefetch" href="/assets/js/52.a84e6cd9.js"><link rel="prefetch" href="/assets/js/53.25865b5e.js"><link rel="prefetch" href="/assets/js/54.98fbd38f.js"><link rel="prefetch" href="/assets/js/55.bf64bf02.js"><link rel="prefetch" href="/assets/js/56.47644959.js"><link rel="prefetch" href="/assets/js/57.884547b0.js"><link rel="prefetch" href="/assets/js/58.a1454125.js"><link rel="prefetch" href="/assets/js/59.c83ad66a.js"><link rel="prefetch" href="/assets/js/6.304c7f99.js"><link rel="prefetch" href="/assets/js/60.f0fe6563.js"><link rel="prefetch" href="/assets/js/61.2c5fa2dd.js"><link rel="prefetch" href="/assets/js/62.bb01d26d.js"><link rel="prefetch" href="/assets/js/63.ec55d357.js"><link rel="prefetch" href="/assets/js/64.1dafb1da.js"><link rel="prefetch" href="/assets/js/65.15b71397.js"><link rel="prefetch" href="/assets/js/66.fe426bd2.js"><link rel="prefetch" href="/assets/js/67.e5979041.js"><link rel="prefetch" href="/assets/js/68.66e3a845.js"><link rel="prefetch" href="/assets/js/69.54c09a83.js"><link rel="prefetch" href="/assets/js/7.27270c89.js"><link rel="prefetch" href="/assets/js/70.a85d096e.js"><link rel="prefetch" href="/assets/js/71.fae5d399.js"><link rel="prefetch" href="/assets/js/72.5b7a7c99.js"><link rel="prefetch" href="/assets/js/73.8bfc01c7.js"><link rel="prefetch" href="/assets/js/74.1479f8a7.js"><link rel="prefetch" href="/assets/js/75.c157a066.js"><link rel="prefetch" href="/assets/js/76.03bb01f6.js"><link rel="prefetch" href="/assets/js/77.59db64c6.js"><link rel="prefetch" href="/assets/js/78.43759a61.js"><link rel="prefetch" href="/assets/js/79.2cd321f7.js"><link rel="prefetch" href="/assets/js/80.9d053f4b.js"><link rel="prefetch" href="/assets/js/81.5d034134.js"><link rel="prefetch" href="/assets/js/82.029c8d5a.js"><link rel="prefetch" href="/assets/js/83.28ed3c62.js"><link rel="prefetch" href="/assets/js/84.293dc258.js"><link rel="prefetch" href="/assets/js/85.14b7fd56.js"><link rel="prefetch" href="/assets/js/86.752aeb6b.js"><link rel="prefetch" href="/assets/js/87.d7bad5bd.js"><link rel="prefetch" href="/assets/js/88.ef1bc142.js"><link rel="prefetch" href="/assets/js/89.ab42cb6f.js"><link rel="prefetch" href="/assets/js/90.e7358e4f.js"><link rel="prefetch" href="/assets/js/91.e91a483f.js"><link rel="prefetch" href="/assets/js/92.be28ea43.js"><link rel="prefetch" href="/assets/js/93.a595dde4.js"><link rel="prefetch" href="/assets/js/94.ccaba8d1.js"><link rel="prefetch" href="/assets/js/95.9a8939be.js"><link rel="prefetch" href="/assets/js/96.d198d943.js"><link rel="prefetch" href="/assets/js/97.ab500429.js"><link rel="prefetch" href="/assets/js/98.93caf700.js"><link rel="prefetch" href="/assets/js/99.9487d289.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2db3a0ea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a2d1e15.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">夜枫林</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="硬件" class="dropdown-title"><span class="title">硬件</span> <span class="arrow down"></span></button> <button type="button" aria-label="硬件" class="mobile-dropdown-title"><span class="title">硬件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/EE/comm/" class="nav-link">
  通信原理
</a></li><li class="dropdown-item"><!----> <a href="/EE/components/" class="nav-link">
  元器件
</a></li><li class="dropdown-item"><!----> <a href="/EE/DB/" class="nav-link">
  开发板
</a></li><li class="dropdown-item"><!----> <a href="/EE/dev/" class="nav-link">
  开发环境
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FE/others/" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><!----> <a href="/FE/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/FE/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/FE/JS/" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/FE/VUE/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/FE/WEB_3D/" class="nav-link">
  WEB_3D
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/RD/com/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/RD/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/RD/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/RD/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/RD/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/RD/tools/" class="nav-link">
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/study/" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/work/" class="nav-link router-link-active">
  工作
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="硬件" class="dropdown-title"><span class="title">硬件</span> <span class="arrow down"></span></button> <button type="button" aria-label="硬件" class="mobile-dropdown-title"><span class="title">硬件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/EE/comm/" class="nav-link">
  通信原理
</a></li><li class="dropdown-item"><!----> <a href="/EE/components/" class="nav-link">
  元器件
</a></li><li class="dropdown-item"><!----> <a href="/EE/DB/" class="nav-link">
  开发板
</a></li><li class="dropdown-item"><!----> <a href="/EE/dev/" class="nav-link">
  开发环境
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FE/others/" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><!----> <a href="/FE/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/FE/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/FE/JS/" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/FE/VUE/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/FE/WEB_3D/" class="nav-link">
  WEB_3D
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/RD/com/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/RD/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/RD/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/RD/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/RD/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/RD/tools/" class="nav-link">
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/study/" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/work/" class="nav-link router-link-active">
  工作
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/work/hardware/" class="sidebar-heading clickable"><span>硬件测试</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/work/software/" class="sidebar-heading clickable router-link-active open"><span>系统集成</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/work/software/485.html" aria-current="page" class="active sidebar-link">RS485网页配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#一、项目规划" class="sidebar-link">一、项目规划</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#_1-1-需求分析" class="sidebar-link">1.1 需求分析</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_1-2-设计流程" class="sidebar-link">1.2 设计流程</a></li></ul></li><li class="sidebar-sub-header"><a href="/work/software/485.html#二、web-服务" class="sidebar-link">二、WEB 服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#_2-1-修改启动" class="sidebar-link">2.1 修改启动</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_2-2-修改http端口" class="sidebar-link">2.2 修改HTTP端口</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_2-3-修改路由" class="sidebar-link">2.3 修改路由</a></li></ul></li><li class="sidebar-sub-header"><a href="/work/software/485.html#三、udp-服务" class="sidebar-link">三、UDP 服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#_3-1-创建服务" class="sidebar-link">3.1 创建服务</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_3-2-udp测试" class="sidebar-link">3.2 UDP测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/work/software/485.html#四、搜索设备" class="sidebar-link">四、搜索设备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#_4-1-搜索指令" class="sidebar-link">4.1 搜索指令</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_4-2-前端代码" class="sidebar-link">4.2 前端代码</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_4-3-后端处理" class="sidebar-link">4.3 后端处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/work/software/485.html#五、获取参数" class="sidebar-link">五、获取参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#_5-1-读取指令" class="sidebar-link">5.1 读取指令</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#_5-2-前端代码" class="sidebar-link">5.2 前端代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/work/software/485.html#六、修改参数" class="sidebar-link">六、修改参数</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#七、功能函数" class="sidebar-link">七、功能函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work/software/485.html#输出信息" class="sidebar-link">输出信息</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#和校验" class="sidebar-link">和校验</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#string-hex" class="sidebar-link">string-hex</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#减和校验" class="sidebar-link">减和校验</a></li><li class="sidebar-sub-header"><a href="/work/software/485.html#连接状态" class="sidebar-link">连接状态</a></li></ul></li></ul></li><li><a href="/work/software/data.html" class="sidebar-link">数据转发</a></li><li><a href="/work/software/strain.html" class="sidebar-link">振弦</a></li><li><a href="/work/software/485horizontal.html" class="sidebar-link">485倾角</a></li><li><a href="/work/software/explorer.html" class="sidebar-link">EXPLORER</a></li><li><a href="/work/software/function.html" class="sidebar-link">相关函数</a></li></ul></section></li><li><a href="/work/devices/net.html" class="sidebar-link">网络设备</a></li><li><a href="/work/debug/" class="sidebar-link">调试系统</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/work/deploy/ubuntu/" class="sidebar-heading clickable"><span>Ubuntu 部署</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rs485网页配置"><a href="#rs485网页配置" class="header-anchor">#</a> RS485网页配置</h1> <h2 id="一、项目规划"><a href="#一、项目规划" class="header-anchor">#</a> 一、项目规划</h2> <h3 id="_1-1-需求分析"><a href="#_1-1-需求分析" class="header-anchor">#</a> 1.1 需求分析</h3> <p>此项目用于网页配置USR-TCP232-306单串口服务器</p> <p><img src="/assets/img/USR-TCP232-306.01575a8b.png" alt="Alt text"></p> <p>USR-TCP232-306是一款工业单串口服务器，小体积，成本可控，实现RS232/485/422转以太网双向透传功能；具备1路以太网口，10/100Mbps速率；支持超时重启、DHCP自动获取IP、DNS域名解析、远程升级、虚拟串口功能；支持自定义心跳包，杜绝死链接；自定义注册包，检测连接状态。</p> <p>产品官网：<a href="https://www.usr.cn/Product/177.html" target="_blank" rel="noopener noreferrer">https://www.usr.cn/Product/177.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-2-设计流程"><a href="#_1-2-设计流程" class="header-anchor">#</a> 1.2 设计流程</h3> <p>有人485设置了专门的配置协议，为了方便跨网段进行配置，所有通讯协议的操作均采用 UDP广播方式完成，排列方式均为低位在前。</p> <p>网络配置时，UDP 通信必须保证目标 IP 为 255.255.255.255，目标端口：1500，排列方式均为低位在前，本地端口号随机，所有通信协议均为 UDP 广播。</p> <p>具体流程为：</p> <ol><li>建立 web 服务器</li></ol> <p>用于访问配置页面。</p> <ol start="2"><li>建立 udp 服务器:</li></ol> <p>建立一个 UDP Socket，发送/接收广播数据。</p> <ol start="3"><li>搜索设备：</li></ol> <ul><li><p>网络端发送搜索命令</p></li> <li><p>306 返回 IP 地址和 MAC，设备名称，版本号</p></li></ul> <ol start="4"><li>读取参数：</li></ol> <ul><li>网络端读取 306 返回参数</li></ul> <ol start="5"><li>保存参数</li></ol> <ul><li><p>根据 MAC 地址和已知的用户名和密码以及要设置的参数（不需要修改的保持原样）组成设置指令</p></li> <li><p>发送设置指令，306 返回设置正确</p></li> <li><p>发送重启指令，306 返回设置正确（或错误）</p></li></ul> <h2 id="二、web-服务"><a href="#二、web-服务" class="header-anchor">#</a> 二、WEB 服务</h2> <p>采用express搭建web服务器</p> <p>项目文件使用 express-generator 生成</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>express --view=pug rs485
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-1-修改启动"><a href="#_2-1-修改启动" class="header-anchor">#</a> 2.1 修改启动</h3> <p>全局安装nodemon</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install -g nodemon
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>package.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./bin/www&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon ./bin/www&quot;</span>  <span class="token comment">// 新增</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动项目</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm run dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-2-修改http端口"><a href="#_2-2-修改http端口" class="header-anchor">#</a> 2.2 修改HTTP端口</h3> <p>/bin/www</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> port <span class="token operator">=</span> <span class="token function">normalizePort</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token string">'64485'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 默认端口3000</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'port'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>添加提示信息：onListening()</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">onListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> bind <span class="token operator">=</span> <span class="token keyword">typeof</span> addr <span class="token operator">===</span> <span class="token string">'string'</span>
    <span class="token operator">?</span> <span class="token string">'pipe '</span> <span class="token operator">+</span> addr
    <span class="token operator">:</span> <span class="token string">'port '</span> <span class="token operator">+</span> addr<span class="token punctuation">.</span>port<span class="token punctuation">;</span>
  <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Listening on '</span> <span class="token operator">+</span> bind<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 打印http服务器信息</span>
  <span class="token keyword">var</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP服务器启动：&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>HTTP服务器启动： { address: '::', family: 'IPv6', port: 64485 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-修改路由"><a href="#_2-3-修改路由" class="header-anchor">#</a> 2.3 修改路由</h3> <p>/routes/index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// res.render('index', { title: 'Express' });</span>
  res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">root</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../views'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>访问: <a href="http://localhost:64485/" target="_blank" rel="noopener noreferrer">http://localhost:64485/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/indexpage.97348965.png" alt="Alt text"></p> <h2 id="三、udp-服务"><a href="#三、udp-服务" class="header-anchor">#</a> 三、UDP 服务</h2> <h3 id="_3-1-创建服务"><a href="#_3-1-创建服务" class="header-anchor">#</a> 3.1 创建服务</h3> <p>/bin/udp-server.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>


server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> address <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">udp-Server running </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    server<span class="token punctuation">.</span><span class="token function">setBroadcast</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 开启广播模式</span>

    <span class="token comment">// const message = Buffer.from('ff010102', 'hex');</span>
    <span class="token comment">// server.send(message, 1500, '255.255.255.255')</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server got msg from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>port<span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'192.168.30.100'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_3-2-udp测试"><a href="#_3-2-udp测试" class="header-anchor">#</a> 3.2 UDP测试</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> message <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ff010102'</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">'255.255.255.255'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>udp-Server running 192.168.30.100:59846
HTTP服务器启动： { address: '::', family: 'IPv6', port: 64485 }
server got msg from 192.168.30.30:1500: ff24010000c0a81e1e9ca525a3fe38b20f00005553522d5443503233322d3330360000cd
server got msg from 192.168.0.7:1500: ff24010000c0a80007d4ad203b4917b20f00005553522d5443503233322d333036000005
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="四、搜索设备"><a href="#四、搜索设备" class="header-anchor">#</a> 四、搜索设备</h2> <p>流程</p> <p>1 点击页面&quot;搜索设备&quot;按钮，发送请求 ： GET /equipmentArray</p> <p>2 后端发送搜索指令，将返回结果存储在 equipmentArray 数组中, 并返回给前端</p> <p>3 前端获取到equipmentArray 数组，将参数添加到table中，显示在页面上</p> <p>接口</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>Client_IP_address<span class="token operator">:</span> item.address   <span class="token comment">// IP</span>
msg<span class="token operator">:</span> item.msg                     <span class="token comment">// 返回报文</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查询表</p> <p><img src="/assets/img/search-table.560c4042.png" alt="Alt text"></p> <h3 id="_4-1-搜索指令"><a href="#_4-1-搜索指令" class="header-anchor">#</a> 4.1 搜索指令</h3> <h4 id="指令测试"><a href="#指令测试" class="header-anchor">#</a> 指令测试</h4> <p>搜索命令固定为：FF 01 01 02，和校验 02 = 01 + 01。</p> <p><img src="/assets/img/search485.231295d3.png" alt="Alt text"></p> <p><img src="/assets/img/rs485list.68a7e044.png" alt="Alt text"></p> <h4 id="搜索返回"><a href="#搜索返回" class="header-anchor">#</a> 搜索返回</h4> <p>搜索指令的返回结果（36字节)：FF 24 01 00 00 C0 A8 00 07 D8 B0 4C 46 35 80 AF 0F 00 00 55 53 52 2D 54 43
50 32 33 32 2D 33 31 30 00 00 F4</p> <p>校验方法为减和校验，校验位初始值为 0x00，依次减去每个字节，算法如下：F4 = 00 - FF - 24 - 01 - 00 – A8 - ... - 30 – 00-…-00。</p> <p><img src="/assets/img/backcmd.06f23c4d.png" alt="Alt text"></p> <p>实例可以参考上一栏：udp测试</p> <h4 id="截取字段"><a href="#截取字段" class="header-anchor">#</a> 截取字段</h4> <p>搜索指令的返回结果（36字节)：FF 24 01 00 00 C0 A8 00 07 D8 B0 4C 46 35 80 AF 0F 00 00 55 53 52 2D 54 43
50 32 33 32 2D 33 31 30 00 00 F4</p> <table><thead><tr><th>名称</th> <th>字节</th> <th>例子</th> <th>说明</th></tr></thead> <tbody><tr><td>TAG_STATUS</td> <td>0</td> <td>FF</td> <td>固定数字</td></tr> <tr><td>Client_IP_address</td> <td>5~8</td> <td>C0 A8 00 07</td> <td>设备 IP（高位在前）</td></tr> <tr><td>MAC_address</td> <td>9~14</td> <td>AC CF 23 20 FE 3D</td> <td>设备 MAC（高位在前）</td></tr> <tr><td>Firemware_version</td> <td>15~18</td> <td>01 00 00</td> <td>固件版本号</td></tr> <tr><td>Application_title</td> <td>19~34</td> <td>55 53 52 2D 4B 32 00 00 00 00 00 00 00 00 00 00</td> <td>设备名称</td></tr></tbody></table> <p>一个字节两位</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>td1<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>Client_IP_address<span class="token punctuation">;</span>    <span class="token comment">// IP 地址</span>
td2<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token function">hexToAscii</span><span class="token punctuation">(</span>equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 设备名称</span>
td3<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(.{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;$1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// MAC 地址</span>
td4<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 设备序列号</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-2-前端代码"><a href="#_4-2-前端代码" class="header-anchor">#</a> 4.2 前端代码</h3> <h4 id="请求事件"><a href="#请求事件" class="header-anchor">#</a> 请求事件</h4> <p>绑定点击事件（搜索设备），向服务器请求设备数据，并在获取到数据后更新表格；</p> <p>同时输出信息(功能函数)和绑定点击事件（获取参数）。</p> <p>/public/javascripts/index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpRequest<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>httpRequest<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 删除table里的旧数据（根据类名来找到那些元素）</span>
            <span class="token keyword">var</span> tableItems <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;equipment-table-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>tableItems<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> responseData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            responseData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">equipment<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 给table 添加新数据</span>
                <span class="token function">addTableData</span><span class="token punctuation">(</span>equipment<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// out(equipment.msg)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 添加获取参数事件</span>
            <span class="token function">bindClickEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    httpRequest<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/equipmentArray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">out</span><span class="token punctuation">(</span><span class="token string">&quot;指令发送成功 -&gt; FF010102&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">out</span><span class="token punctuation">(</span><span class="token string">&quot;点击搜到的设备可读取参数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 绑定点击事件</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'searchBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> getData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="显示设备"><a href="#显示设备" class="header-anchor">#</a> 显示设备</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addTableData</span><span class="token punctuation">(</span><span class="token parameter">equipment<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>equipment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 给table添加数据</span>
    <span class="token keyword">var</span> tbody <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tbody<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'equipment-table-item equipment-table-item'</span> <span class="token operator">+</span> index<span class="token punctuation">;</span>

    <span class="token keyword">var</span> tr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> td1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> td2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> td3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> td4 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    td1<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>Client_IP_address<span class="token punctuation">;</span>
    td2<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token function">hexToAscii</span><span class="token punctuation">(</span>equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    td3<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(.{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;$1 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    td4<span class="token punctuation">.</span>innerText <span class="token operator">=</span> equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>td1<span class="token punctuation">)</span>
    tr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>td2<span class="token punctuation">)</span>
    tr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>td3<span class="token punctuation">)</span>
    tr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>td4<span class="token punctuation">)</span>
    tbody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span>
    tbody<span class="token punctuation">.</span>id <span class="token operator">=</span> equipment<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> devTable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'dev-table'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    devTable<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tbody<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_4-3-后端处理"><a href="#_4-3-后端处理" class="header-anchor">#</a> 4.3 后端处理</h3> <h4 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h4> <p>/routes/index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 获取设备 */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/equipmentArray'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> udpServer<span class="token punctuation">.</span><span class="token function">getEquipment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    udpServer<span class="token punctuation">.</span>equipmentArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">Client_IP_address</span><span class="token operator">:</span> item<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> item<span class="token punctuation">.</span>msg
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Failed to get equipment information'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="广播搜索"><a href="#广播搜索" class="header-anchor">#</a> 广播搜索</h4> <p>/bin/udp-server.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> udpServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../bin/udp-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 广播搜索设备</span>
<span class="token keyword">function</span> <span class="token function">getEquipment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> message <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ff010102'</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">'255.255.255.255'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            remoteInfo<span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">addEquipment</span><span class="token punctuation">(</span>remoteInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log(equipmentArray);</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>equipmentArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="五、获取参数"><a href="#五、获取参数" class="header-anchor">#</a> 五、获取参数</h2> <h3 id="_5-1-读取指令"><a href="#_5-1-读取指令" class="header-anchor">#</a> 5.1 读取指令</h3> <h4 id="指令测试-2"><a href="#指令测试-2" class="header-anchor">#</a> 指令测试</h4> <p>发送(22 字节)：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>FF 13 03 00 72 77 7B 63 0D 61 64 6D 69 6E 00 61 64 6D 69 6E 00 FC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>和校验：（5）FC = 13 + 03 + 00 + ... + 6E + 00</p> <p>第 4 位到第 9 位是 306 的 MAC 地址，校验位前的最后的 12 个字节为 306 的用户名与密码，均为 6 字节，不足，补 0。</p> <p>FF 24 01 00 00 C0 A8 00 07 D4 AD 20 3B 49 17 B2 0F 00 00 55 53 52 2D 54 43 50 32 33 32 2D 33 30 36 00 00 05</p> <p>测试</p> <p><img src="/assets/img/crc16search.ff7b8e10.png" alt="Alt text"></p> <p>和校验：（6）64= 1303D4AD203B491761646D696E0061646D696E00</p> <h4 id="指令返回"><a href="#指令返回" class="header-anchor">#</a> 指令返回</h4> <p>返回的是 306 的所有参数，一共是 567 字节，不带校验，没有协议，直接返回参数。</p> <p>读取方式参考“基础参数表”和“串口参数表”以及透传云功能，心跳注册包功能和 Httpd Client 包头设置。</p> <p>分为四个包返回，分别为 130 字节和 50 字节，85 字节（心跳包），302 字节。</p> <p>密码错误回应：FF 01 03 50，返回的数据是不带校验的。</p> <p>实例</p> <p>[ 192.168.30.100 : 58621 ] → [ 255.255.255.255 : 1500 ]
[ Length : 22 ]
FF 13 03 9C A5 25 A3 FE 38 61 64 6D 69 6E 00 61 64 6D 69 6E 00 67</p> <p>[ 192.168.30.100 : 58621 ] ← [ 192.168.30.30 : 1500 ]
[ Length : 130 ]
95 63 03 C0 00 00 50 00 00 1E 1E A8 C0 01 1E A8 C0 00 FF FF FF 55 53 52 2D 54 43 50 32 33 32 2D 33 30 36 00 00 61 64 6D 69 6E 00 61 64 6D 69 6E 00 00 01 00 A0 9C A5 25 A3 FE 38 DE DE 43 D0 03 00 00 00 80 25 00 00 08 01 01 01 00 00 00 00 B4 14 EF D0 31 39 32 2E 31 36 38 2E 33 30 2E 31 30 30 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 64 1E A8 C0 20 01 00 04 10 0E 00 00 00 00 00 00 00</p> <p>[ 192.168.30.100 : 58621 ] ← [ 192.168.30.30 : 1500 ]
[ Length : 50 ]
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p> <p>[ 192.168.30.100 : 58621 ] ← [ 192.168.30.30 : 1500 ]
[ Length : 85 ]
04 1E 00 0A 0A 77 77 77 2E 75 73 72 2E 63 6E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 77 77 77 2E 75 73 72 2E 63 6E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p> <p>[ 192.168.30.100 : 58621 ] ← [ 192.168.30.30 : 1500 ]
[ Length : 302 ]
07 2F 31 2E 70 68 70 3F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 2E 55 73 65 72 5F 41 67 65 6E 74 3A 20 4D 6F 7A 69 6C 6C 61 2F 34 2E 30 0D 0A 43 6F 6E 6E 65 63 74 69 6F 6E 3A 20 6B 65 65 70 61 6C 69 76 65 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p> <h4 id="截取字段-2"><a href="#截取字段-2" class="header-anchor">#</a> 截取字段</h4> <h3 id="_5-2-前端代码"><a href="#_5-2-前端代码" class="header-anchor">#</a> 5.2 前端代码</h3> <p>在鼠标指针移动到 tr 元素上方时显示光标，可以使用 CSS 中的 cursor 属性来实现。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">tr:hover</span> <span class="token punctuation">{</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token comment">/* 设置光标样式为手型 */</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="请求事件-2"><a href="#请求事件-2" class="header-anchor">#</a> 请求事件</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 绑定点击事件到设备项</span>
<span class="token keyword">function</span> <span class="token function">bindClickEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> equipments <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'equipment-table-item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>equipments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>equipments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> getArgument<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取参数请求</span>
<span class="token keyword">function</span> <span class="token function">getArgument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpRequest<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/argument'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="六、修改参数"><a href="#六、修改参数" class="header-anchor">#</a> 六、修改参数</h2> <p>实例</p> <p>（1）基础设置</p> <p>[ 192.168.30.100 : 56951 ] → [ 255.255.255.255 : 1500 ]
[ Length : 89 ]
FF 56 05 D4 AD 20 3B 49 17 61 64 6D 69 6E 00 61 64 6D 69 6E 00 95 63 03 C0 00 00 50 00 00 07 00 A8 C0 01 00 A8 C0 00 FF FF FF 55 53 52 2D 54 43 50 32 33 32 2D 33 30 36 00 00 61 64 6D 69 6E 00 61 64 6D 69 6E 00 00 01 00 A0 D4 AD 20 3B 49 17 DE DE 43 D0 03 00 00 00 B5</p> <p>（2）串口设置</p> <p>[ 192.168.30.100 : 56951 ] → [ 255.255.255.255 : 1500 ]
[ Length : 85 ]
FF 52 06 D4 AD 20 3B 49 17 61 64 6D 69 6E 00 61 64 6D 69 6E 00 00 C2 01 00 08 01 01 01 00 00 00 00 00 00 2A 20 31 39 32 2E 31 36 38 2E 30 2E 32 30 31 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C9 00 A8 C0 20 01 00 04 10 0E 00 00 00 00 00 00 00 BA</p> <p>（3）心跳设置</p> <p>[ 192.168.30.100 : 56951 ] → [ 255.255.255.255 : 1500 ]
[ Length : 107 ]
FF 68 21 D4 AD 20 3B 49 17 61 64 6D 69 6E 00 61 64 6D 69 6E 00 04 1E 00 0A 0A 77 77 77 2E 75 73 72 2E 63 6E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 77 77 77 2E 75 73 72 2E 63 6E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 E5</p> <p>（4）重启</p> <p>[ 192.168.30.100 : 56951 ] → [ 255.255.255.255 : 1500 ]
[ Length : 22 ]
FF 13 02 D4 AD 20 3B 49 17 61 64 6D 69 6E 00 61 64 6D 69 6E 00 63</p> <p>（5）返回</p> <p>[ 192.168.30.100 : 56951 ] ← [ 192.168.0.7 : 1500 ]
[ Length : 4 ]
FF 01 05 4B</p> <p>[ 192.168.30.100 : 56951 ] ← [ 192.168.0.7 : 1500 ]
[ Length : 4 ]
FF 01 06 4B</p> <p>[ 192.168.30.100 : 56951 ] ← [ 192.168.0.7 : 1500 ]
[ Length : 4 ]
FF 01 21 4B</p> <p>[ 192.168.30.100 : 56951 ] ← [ 192.168.0.7 : 1500 ]
[ Length : 4 ]
FF 01 02 4B</p> <h2 id="七、功能函数"><a href="#七、功能函数" class="header-anchor">#</a> 七、功能函数</h2> <h3 id="输出信息"><a href="#输出信息" class="header-anchor">#</a> 输出信息</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">err</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token comment">// 红色显示错误信息</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> <span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">&quot;&lt;p style='color:red'&gt;&quot;</span> <span class="token operator">+</span> time <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
        dom<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> dom<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token comment">// 蓝色显示消息</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> <span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">&quot;&lt;p style='color:blue'&gt;&quot;</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
        dom<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> dom<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token comment">// 简单输出消息</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> <span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">&quot;&lt;p&gt;&quot;</span> <span class="token operator">+</span> time <span class="token operator">+</span> <span class="token string">&quot;：&quot;</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">&quot;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
        dom<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> dom<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="和校验"><a href="#和校验" class="header-anchor">#</a> 和校验</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">computeCrcSum</span><span class="token punctuation">(</span><span class="token parameter">hexString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 去除字符串中的空格</span>
    <span class="token keyword">const</span> hexStringWithoutSpace <span class="token operator">=</span> hexString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将字符串转换为十六进制数组</span>
    <span class="token keyword">const</span> hexArray <span class="token operator">=</span> hexStringWithoutSpace<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.{2}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算所有值的和</span>
    <span class="token keyword">const</span> sum <span class="token operator">=</span> hexArray<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 转换为十六进制形式并输出后两位</span>
    <span class="token comment">// console.log(sum.toString(16).toUpperCase().slice(-2));</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用函数并传入不同的字符串进行计算</span>
<span class="token function">computeCrcSum</span><span class="token punctuation">(</span><span class="token string">&quot;13 03 D4 AD203B491761646D696E0061646D696E00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">computeCrcSum</span><span class="token punctuation">(</span><span class="token string">&quot;13 03 00 72 77 7B 63 0D 61 64 6D 69 6E 00 61 64 6D 69 6E 00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">computeCrcSum</span><span class="token punctuation">(</span><span class="token string">&quot;1234567890ABCDEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="string-hex"><a href="#string-hex" class="header-anchor">#</a> string-hex</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hexToString</span><span class="token punctuation">(</span><span class="token parameter">hex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>hex<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">hexToString</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">stringToHex</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> inputString <span class="token operator">=</span> <span class="token string">&quot;192.168.30.100&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 输入的字符串</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">stringToHex</span><span class="token punctuation">(</span>inputString<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>FF 56 05 D4 AD 20 3B 49 17 61 64 6D 69 6E 00 61 64 6D 69 6E 00 95 63 03 C0 00 00 50 00 00 07 1E A8 C0 01 00 A8 C0 00 FF FF FF 55 53 52 2D 54 43 50 32 33 32 2D 33 30 36 00 00 61 64 6D 69 6E 00 61 64 6D 69 6E 00 00 01 00 A0 D4 AD 20 3B 49 17 DE DE 43 D0 03 00 00 00 D3</p> <h3 id="减和校验"><a href="#减和校验" class="header-anchor">#</a> 减和校验</h3> <h3 id="连接状态"><a href="#连接状态" class="header-anchor">#</a> 连接状态</h3> <p>Ubuntu下执行netstat命令可以查看端口使用情况（但是无法查看进程ID，需要使用lsof命令）</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">netstat</span> <span class="token parameter variable">-anp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">12000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>需求：</p> <p>思路：在Node.js中，可以使用child_process模块来执行系统命令并获取其输出结果，然后将结果封装进一个json对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getCommandOutput</span><span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将命令输出结果转换为JSON对象的函数</span>
<span class="token keyword">function</span> <span class="token function">parseNetstatOutput</span><span class="token punctuation">(</span><span class="token parameter">output</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lines <span class="token operator">=</span> output<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> parts <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Proto'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Recv-Q'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Send-Q'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Local Address'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Foreign Address'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'State'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">'PID/Program name'</span><span class="token operator">:</span> parts<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义要查看的端口号</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">12000</span><span class="token punctuation">;</span>

<span class="token comment">// 构建命令</span>
<span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">netstat -anp | grep </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// 调用getCommandOutput函数执行命令并获取输出结果</span>
<span class="token function">getCommandOutput</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">output</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">parseNetstatOutput</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印输出结果</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Command execution failed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>输出</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token punctuation">{</span> Proto<span class="token operator">:</span> 'tcp6'<span class="token punctuation">,</span>
    'Recv-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Send-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Local Address'<span class="token operator">:</span> '<span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span><span class="token number">12000</span>'<span class="token punctuation">,</span>
    'Foreign Address'<span class="token operator">:</span> '<span class="token operator">:</span><span class="token operator">:</span><span class="token operator">:</span>*'<span class="token punctuation">,</span>
    State<span class="token operator">:</span> 'LISTEN'<span class="token punctuation">,</span>
    'PID/Program name'<span class="token operator">:</span> '<span class="token number">28532</span>/java' <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> Proto<span class="token operator">:</span> 'tcp6'<span class="token punctuation">,</span>
    'Recv-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Send-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Local Address'<span class="token operator">:</span> '<span class="token number">192.168</span>.<span class="token number">30.100</span><span class="token operator">:</span><span class="token number">12000</span>'<span class="token punctuation">,</span>
    'Foreign Address'<span class="token operator">:</span> '<span class="token number">192.168</span>.<span class="token number">30.115</span><span class="token operator">:</span><span class="token number">12115</span>'<span class="token punctuation">,</span>
    State<span class="token operator">:</span> 'ESTABLISHED'<span class="token punctuation">,</span>
    'PID/Program name'<span class="token operator">:</span> '<span class="token number">28532</span>/java' <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> Proto<span class="token operator">:</span> 'tcp6'<span class="token punctuation">,</span>
    'Recv-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Send-Q'<span class="token operator">:</span> '<span class="token number">0</span>'<span class="token punctuation">,</span>
    'Local Address'<span class="token operator">:</span> '<span class="token number">192.168</span>.<span class="token number">30.100</span><span class="token operator">:</span><span class="token number">12000</span>'<span class="token punctuation">,</span>
    'Foreign Address'<span class="token operator">:</span> '<span class="token number">192.168</span>.<span class="token number">30.125</span><span class="token operator">:</span><span class="token number">12125</span>'<span class="token punctuation">,</span>
    State<span class="token operator">:</span> 'ESTABLISHED'<span class="token punctuation">,</span>
    'PID/Program name'<span class="token operator">:</span> '<span class="token number">28532</span>/java' <span class="token punctuation">}</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/3/2024, 9:44:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/work/hardware/01_strain.html" class="prev">
        振弦应变
      </a></span> <span class="next"><a href="/work/software/data.html">
        数据转发
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d1f89baa.js" defer></script><script src="/assets/js/2.33a11089.js" defer></script><script src="/assets/js/1.44c9c021.js" defer></script><script src="/assets/js/18.60874fbd.js" defer></script>
  </body>
</html>
