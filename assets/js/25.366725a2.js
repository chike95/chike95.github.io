(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{394:function(_,t,a){_.exports=a.p+"assets/img/read204.c6700d06.png"},395:function(_,t,a){_.exports=a.p+"assets/img/read204b.55ab6644.png"},396:function(_,t,a){_.exports=a.p+"assets/img/read768128.999cacf7.png"},397:function(_,t,a){_.exports=a.p+"assets/img/read768128b.58acee73.png"},503:function(_,t,a){"use strict";a.r(t);var s=a(14),e=Object(s.a)({},(function(){var _=this,t=_._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"振弦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#振弦"}},[_._v("#")]),_._v(" 振弦")]),_._v(" "),t("h2",{attrs:{id:"通讯地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通讯地址"}},[_._v("#")]),_._v(" 通讯地址")]),_._v(" "),t("h3",{attrs:{id:"定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定义"}},[_._v("#")]),_._v(" 定义")]),_._v(" "),t("p",[_._v("485通信的基本命令是读/写 + 地址 + 数据，其中地址为32位（4字节）。")]),_._v(" "),t("p",[_._v("为了编程方便，地址划分为5个区，功能如下：")]),_._v(" "),t("h3",{attrs:{id:"s1-存储配置参数地址4-36"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#s1-存储配置参数地址4-36"}},[_._v("#")]),_._v(" S1   存储配置参数地址4 – 36")]),_._v(" "),t("p",[_._v("#define ADDR_BOOST_VOLTAGE      4 振弦PWM波电压，默认为5, （新板子只支持5v）")]),_._v(" "),t("p",[_._v("#define ADDR_MEASURE_CHANNEL    4 + 4手动模式下测量的通道号，0-15可选 (暂时不用)")]),_._v(" "),t("p",[_._v("#define ADDR_WROK_MODE          4 + 8为0为自动模式（自动检测通道是否有传感器）")]),_._v(" "),t("p",[_._v("#define ADDR_SAMPLE_RATE        4 + 12采样率，默认可设置为5，表示5秒采样一次")]),_._v(" "),t("p",[_._v("#define ADDR_SLAVE_ADDR         4 + 16从机地址，其中0地址为公共地址，所有板子均可通信，1-65535可选")]),_._v(" "),t("p",[_._v("#define ADDR_RESET_CONFIG       4 + 20写1时复位配置参数")]),_._v(" "),t("p",[_._v("#define ADDR_FRAM_PAGE_INDEX    4 + 24当前铁电存储器（32KB）的页码（当前正在写入的页，0-7 ，每页4KB）")]),_._v(" "),t("p",[_._v("#define ADDR_FRAM_ITEM_INDEX    4 + 28当前铁电存储器页内组号码（0-31），每页32个")]),_._v(" "),t("p",[_._v("#define ADDR_FLASH_PAGE_INDEX   4 + 32当前flash存储的页码（0-511）（新板子不再用flash）")]),_._v(" "),t("p",[_._v("#define ADDR_START_STOP    4 + 40 启动/停止测量开关（0 = 停止，1=开始）")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL1      4 + 44 通道1激励频率选择:0-3")]),_._v(" "),t("p",[_._v("[0 : 400-1200]\n[1 : 1200-3500]\n[2 : 1800-3500]\n[3 : 2500-4000]")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL2      4 + 48 通道2激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL3      4 + 52 通道3激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL4      4 + 56 通道4激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL5      4 + 60 通道5激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL6      4 + 64 通道6激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL7      4 + 68 通道7激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL8      4 + 72 通道8激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL9      4 + 76 通道9激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL10      4 + 80 通道10激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL11      4 + 84 通道11激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL12      4 + 88 通道12激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL13      4 + 92 通道13激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL14      4 + 96 通道14激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL15      4 + 100 通道15激励频率选择")]),_._v(" "),t("p",[_._v("#define ADDR_CHAN_FREQ_SEL16      4 + 104 通道16激励频率选择")]),_._v(" "),t("p",[t("strong",[_._v("(下面蓝色为新增地址)")])]),_._v(" "),t("p",[_._v("#define ADDR_KEY_START             4 + 108 签名存储起始地址")]),_._v(" "),t("p",[_._v("#define ADDR_KEY_END              4 + 360 签名存储结束地址")]),_._v(" "),t("p",[_._v("#define ADDR_RSV_1                4 + 364  预留不用地址")]),_._v(" "),t("p",[_._v("#define ADDR_HOST_IP_1            4 + 368  主机ip第1个数字, 默认为192.168.30.100")]),_._v(" "),t("p",[_._v("#define ADDR_HOST_IP_2            4 + 372  主机ip第2个数字")]),_._v(" "),t("p",[_._v("#define ADDR_HOST_IP_3            4 + 376 主机ip第3个数字")]),_._v(" "),t("p",[_._v("#define ADDR_HOST_IP_4            4 + 380 主机ip第4个数字")]),_._v(" "),t("p",[_._v("#define ADDR_HOST_PORT           4 + 384 主机端口号，默认为13010")]),_._v(" "),t("h3",{attrs:{id:"s2-数值存储区地址512-600"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#s2-数值存储区地址512-600"}},[_._v("#")]),_._v(" S2 数值存储区地址512-600")]),_._v(" "),t("p",[_._v("#define ADDR_SW_VERSION       512 软件版本号，用来区分单片机的不同软件版本")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_SEC         512 + 4秒（读取时返回当前时间，写入时设置时间）")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_MIN         512 + 8分")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_HOUR        512 + 12时")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_DAY         512 + 16日")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_MON         512 + 20月")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_WEEK        512 + 24星期")]),_._v(" "),t("p",[_._v("#define ADDR_TIME_YEAR        512 + 28年")]),_._v(" "),t("p",[_._v("#define ADDR_VOLT_VAL         512 + 32当前通道的电压值（电阻值*0.21mA）")]),_._v(" "),t("p",[_._v("#define ADDR_RES_VAL          512 + 36当前通道的电阻值")]),_._v(" "),t("p",[_._v("#define ADDR_FREQ_VAL_C1      512 + 40当前通道的频率值（2次采样中的最优值）")]),_._v(" "),t("p",[_._v("#define ADDR_FREQ_VAL         512 + 44")]),_._v(" "),t("p",[_._v("#define ADDR_FREQ_VAL2        512 + 48")]),_._v(" "),t("p",[_._v("#define ADDR_FREQ_EVAL_S1     512 + 52 第1次采样的频率值")]),_._v(" "),t("p",[_._v("#define ADDR_FREQ_EVAL_S2     512 + 56第2次采样的频率值")]),_._v(" "),t("p",[_._v("#define ADDR_SQURE_SUM_S1     512 + 60第1次频率值的方差")]),_._v(" "),t("p",[_._v("#define ADDR_SQURE_SUM_S2     512 + 64第2次频率值的方差")]),_._v(" "),t("p",[_._v("#define ADDR_CONTROL          512 + 68")]),_._v(" "),t("p",[_._v("#define ADDR_CHANNEL_MASK     512 + 72通道传感器状态，0-15位每位为1表示有传感器")]),_._v(" "),t("p",[_._v("#define ADDR_ERR_STATUS_1     512 + 76    错误状态")]),_._v(" "),t("p",[_._v("#define ADDR_SAMPLE_TICKS     512 + 80")]),_._v(" "),t("p",[_._v("#define ADDR_CURR_FRAM_ADDR   512 + 84   Fram存储器最后一次写入的地址（128字节值的起始地址，从起始地址开始往前计算是之前写入的地址）")]),_._v(" "),t("p",[_._v("#define ADDR_CURR_FLASH_ADDR  512 + 88    Flash存储器最后一次写入的地址（4KB页的开始地址），Flash的地址从1MB到3MB,对应页码0-511页")]),_._v(" "),t("p",[t("strong",[_._v("（以下蓝色为新增地址）")]),_._v("\n#define ADDR_BOARDID_1        512 + 92 板子的ID，每个芯片唯一")]),_._v(" "),t("p",[_._v("#define ADDR_BOARDID_2        512 + 96")]),_._v(" "),t("p",[_._v("#define ADDR_BOARDID_3        512 + 100")]),_._v(" "),t("p",[_._v("#define ADDR_BOARDID_4        512 + 104")]),_._v(" "),t("p",[_._v("#define ADDR_BOARDID_5        512 + 108")]),_._v(" "),t("p",[_._v("#define ADDR_KEY_STATUS        512 + 112  为1时表示签名正确")]),_._v(" "),t("p",[_._v("#define ADDR_BIN_STATUS        512 + 116  为1时表示程序是完整的")]),_._v(" "),t("p",[_._v("#define ADDR_REBOOT_FLAG      512 + 120  写1后板子重启")]),_._v(" "),t("p",[_._v("#define ADDR_ACTIVE_CHANNELS  512 + 124  读取该地址可获取当前连接传感器的通道状态 (第1位为1 表示通道1传感器已连接，第2位为1表示通道2传感器已连接)")]),_._v(" "),t("h3",{attrs:{id:"s3-16通道的频率和电阻数据-地址768-896"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#s3-16通道的频率和电阻数据-地址768-896"}},[_._v("#")]),_._v(" S3 16通道的频率和电阻数据，地址768-896")]),_._v(" "),t("p",[_._v("按照通道1频率，通道1电阻，。。。通道15频率，通道15电阻的顺序排列，每个值为4个字节")]),_._v(" "),t("p",[_._v("补充下，128字节存储的格式如下：")]),_._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[_._v("//data is saved at 128byte aligenment")]),_._v("\ntypedefstruct\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint32_t")]),_._v(" magic_word1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v(" 标志位，固定为"),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("0xc869fc43")]),_._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" data_format_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v(" 格式类型为"),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("1")]),_._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" header_length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("    头长度为"),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("20")]),_._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("char")]),_._v("     time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("          存储时间，顺序为 秒分时日月星期年\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" channel_mask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("     从"),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("15")]),_._v("位，为"),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("1")]),_._v("表示该通道有值\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" sample_rate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("      采样率\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" header_crc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("       头的crc16校验值\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" freq_res_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v(" 频率和电阻数据，顺序为freq1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("res1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("freq2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("res2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),_._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[_._v("uint16_t")]),_._v(" data_crc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("         数据的crc16校验值\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),_._v("SavedDataFormat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br"),t("span",{staticClass:"line-number"},[_._v("2")]),t("br"),t("span",{staticClass:"line-number"},[_._v("3")]),t("br"),t("span",{staticClass:"line-number"},[_._v("4")]),t("br"),t("span",{staticClass:"line-number"},[_._v("5")]),t("br"),t("span",{staticClass:"line-number"},[_._v("6")]),t("br"),t("span",{staticClass:"line-number"},[_._v("7")]),t("br"),t("span",{staticClass:"line-number"},[_._v("8")]),t("br"),t("span",{staticClass:"line-number"},[_._v("9")]),t("br"),t("span",{staticClass:"line-number"},[_._v("10")]),t("br"),t("span",{staticClass:"line-number"},[_._v("11")]),t("br"),t("span",{staticClass:"line-number"},[_._v("12")]),t("br"),t("span",{staticClass:"line-number"},[_._v("13")]),t("br")])]),t("h3",{attrs:{id:"s4-fram铁电存储器空间-地址4096-32768-对应32kb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#s4-fram铁电存储器空间-地址4096-32768-对应32kb"}},[_._v("#")]),_._v(" S4 Fram铁电存储器空间，地址4096-32768 （对应32KB）")]),_._v(" "),t("p",[_._v("读取每个128字节存储单元获得存储的数据，当前地址ADDR_CURR_FRAM_ADDR表示最后一次写入的地址，往前读取旧的数据。")]),_._v(" "),t("h3",{attrs:{id:"s5-flash存储器空间-地址-10241024-31024-1024-对应1mb-3mb-新板子不再使用flash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#s5-flash存储器空间-地址-10241024-31024-1024-对应1mb-3mb-新板子不再使用flash"}},[_._v("#")]),_._v(" S5 Flash存储器空间，地址 1024"),t("em",[_._v("1024 – 3")]),_._v("1024*1024 (对应1MB-3MB) （新板子不再使用flash）")]),_._v(" "),t("p",[_._v("读取每个128字节获得存储的数据，当前地址ADDR_CURR_FLASH_ADDR表示最后一次写入的地址，往前读取旧的数据。（0-511页是循环写入，即0到511写入，然后重新从0开始写入，第0页对应地址1024"),t("em",[_._v("1024，第511页对应地址1024")]),_._v("1024+511*4096）")]),_._v(" "),t("h3",{attrs:{id:"tcp连接说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp连接说明"}},[_._v("#")]),_._v(" TCP连接说明：")]),_._v(" "),t("p",[_._v("TCP连接默认端口为13010, ip地址为192.168.30.100，通信协议和485的相同；PC侧为tcp server, 板子为tcp client.")]),_._v(" "),t("h2",{attrs:{id:"通讯协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通讯协议"}},[_._v("#")]),_._v(" 通讯协议")]),_._v(" "),t("p",[_._v("可以485通讯，也可以网口通讯。上位机指令包括写指令以及读指令。")]),_._v(" "),t("h3",{attrs:{id:"读指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读指令"}},[_._v("#")]),_._v(" 读指令")]),_._v(" "),t("h4",{attrs:{id:"功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[_._v("#")]),_._v(" 功能")]),_._v(" "),t("p",[_._v("上位机读取指令用于读取仪器的信息，包括功能：")]),_._v(" "),t("p",[_._v("1、\t读取仪器地址 read  20  4")]),_._v(" "),t("p",[_._v("2、\t读取仪器测量到的传感器的频率以及温敏电阻值  read  768  128")]),_._v(" "),t("h4",{attrs:{id:"解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解析"}},[_._v("#")]),_._v(" 解析")]),_._v(" "),t("p",[_._v("PC读指令（read）：  02 ，仪器相应的回复指令：03")]),_._v(" "),t("p",[_._v("读取指令格式（长度14个字节，先发低位再发高位）：")]),_._v(" "),t("p",[_._v("仪器地址（2个字节）+帧头(0XEFD7)+读/写指令（2个字节）+内存地址（4个字节）+数据长度（2个字节）+CRC1校验/固定校验（0xD3F8）")]),_._v(" "),t("p",[_._v("数据发送接收都是先发低位再发高位")]),_._v(" "),t("p",[_._v("内存分配表：")]),_._v(" "),t("p",[_._v("内存地址\t存储内容")]),_._v(" "),t("p",[_._v("20\t仪器地址")]),_._v(" "),t("p",[_._v("768~（768+128）\t传感器频率、温敏电阻值")]),_._v(" "),t("h4",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[_._v("#")]),_._v(" 实例")]),_._v(" "),t("p",[_._v("一、读取仪器地址")]),_._v(" "),t("p",[t("img",{attrs:{src:a(394),alt:"Alt text"}})]),_._v(" "),t("p",[_._v("仪器返回")]),_._v(" "),t("p",[t("img",{attrs:{src:a(395),alt:"Alt text"}})]),_._v(" "),t("p",[_._v("仪器地址是478")]),_._v(" "),t("p",[_._v("CRC1校验从第4位（回复指令）开始，校验长度为8。")]),_._v(" "),t("p",[_._v("CRC2校验从14位开始校验（仪器地址），校验长度4。")]),_._v(" "),t("p",[_._v("二、读取数据")]),_._v(" "),t("p",[_._v("PC发送指令（read  768   128）")]),_._v(" "),t("p",[t("img",{attrs:{src:a(396),alt:"Alt text"}})]),_._v(" "),t("p",[_._v("仪器返回")]),_._v(" "),t("p",[t("img",{attrs:{src:a(397),alt:"Alt text"}})]),_._v(" "),t("p",[_._v("仪器共有16个通道，每个通道占用8个字节存储数据，前4个字节存储频率数据，后4个字节存储温度数据。CRC1校验从第4位（回复指令）开始，校验长度为8，CRC2校验从14位开始校验（第一通道频率值），校验长度128。")]),_._v(" "),t("p",[_._v("注：频率放大了10倍，单位为HZ，温度电阻单位为Ω。")]),_._v(" "),t("h3",{attrs:{id:"写指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#写指令"}},[_._v("#")]),_._v(" 写指令")])])}),[],!1,null,null,null);t.default=e.exports}}]);