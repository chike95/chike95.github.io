(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{488:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"三、程序部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、程序部署"}},[s._v("#")]),s._v(" 三、程序部署")]),s._v(" "),a("h2",{attrs:{id:"_3-1-文件迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-文件迁移"}},[s._v("#")]),s._v(" 3.1 文件迁移")]),s._v(" "),a("h3",{attrs:{id:"_3-1-1-配置修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-配置修改"}},[s._v("#")]),s._v(" 3.1.1 配置修改")]),s._v(" "),a("h2",{attrs:{id:"_3-2-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-数据库"}},[s._v("#")]),s._v(" 3.2 数据库")]),s._v(" "),a("h2",{attrs:{id:"_3-3-开机自启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-开机自启"}},[s._v("#")]),s._v(" 3.3 开机自启")]),s._v(" "),a("p",[s._v("参考教程：")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/djstavaV/article/details/88166805",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/djstavaV/article/details/88166805"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://xugaoxiang.com/2019/12/05/systemd-rc-local-on-boot/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://xugaoxiang.com/2019/12/05/systemd-rc-local-on-boot/"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_3-3-1-建立rc-local-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-建立rc-local-service"}},[s._v("#")]),s._v(" 3.3.1 建立rc-local.service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo vim /etc/systemd/system/rc-local.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将下列内容复制进rc-local.service文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Unit]\nDescription=/etc/rc.local Compatibility\nConditionPathExists=/etc/rc.local\n \n[Service]\nType=forking\nExecStart=/etc/rc.local start\nTimeoutSec=0\nStandardOutput=tty\nRemainAfterExit=yes\nSysVStartPriority=99\n \n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_3-3-2-创建rc-local"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-创建rc-local"}},[s._v("#")]),s._v(" 3.3.2 创建rc.local")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo vim /etc/rc.local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("下列内容复制进rc.local文件")]),s._v(" "),a("p",[s._v("tomcat 项目配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#!/bin/sh -e\n#\n# rc.local\n#\n# This script is executed at the end of each multiuser runlevel.\n# Make sure that the script will \"exit 0\" on success or any other\n# value on error.\n#\n# In order to enable or disable this script just change the execution\n# bits.\n#\n# By default this script does nothing.\n#!bin/bash -e\ntime=$(date \"+%Y-%m-%d %H:%M:%S\")\nsu root\n\nsudo autossh -M 50721 -fCNR '*:50722:127.0.0.1:22' root@123.206.175.241 &\n\ncd /srv/project/donganhu\n./start-t.sh\ncd /srv/apache-tomcat-7.0.63/bin\n./startup.sh\necho '${time} restart autossh at 50522' >> /srv/project/donganhu/restart.log\necho 'donganhu-t jar restarted!' >> /srv/project/donganhu/restart.log\nexit 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("这段脚本是一个启动脚本，通常用于在系统启动后执行一些必要的操作。根据脚本的内容，它执行以下操作：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("获取当前时间并将其保存到变量 time 中。\n使用 su root 切换到 root 用户。请注意，这里没有提供密码，所以需要确认系统已经配置为允许该用户无需密码切换到 root 用户。\n使用 autossh 命令建立一个反向 SSH 隧道，将远程主机的 22 端口映射到本地的 50722 端口。这样可以实现对远程主机的安全访问。\n切换到 /srv/project/donganhu 目录，并执行名为 start-t.sh 的脚本。\n切换到 /srv/apache-tomcat-7.0.63/bin 目录，并执行 startup.sh 脚本，启动 Tomcat 服务器。\n将重启信息和日志记录到 /srv/project/donganhu/restart.log 文件中。\n最后，脚本退出。\n")])])]),a("p",[s._v("springboot 项目配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#!/bin/sh -e\n#\n# rc.local\n#\n# This script is executed at the end of each multiuser runlevel.\n# Make sure that the script will \"exit 0\" on success or any other\n# value on error.\n#\n# In order to enable or disable this script just change the execution\n# bits.\n#\n# By default this script does nothing.\n\n#!bin/bash -e\ntime=$(date \"+%Y-%m-%d %H:%M:%S\")\nsu ysb\n\nsudo autossh -M 50755 -fCNR '*:50754:127.0.0.1:22' root@123.206.175.241 &\nsudo autossh -M 50766 -fCNR '*:50763:127.0.0.1:8010' root@123.206.175.241 &\n\ncd /srv/project/\n./start.sh\necho ${time}' restart autossh' >> /srv/project/restart.log\necho 'tl-twg jar restarted!' >> /srv/project/restart.log\nexit 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("这段脚本也是一个启动脚本，和之前的脚本类似，它执行以下操作：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("获取当前时间并将其保存到变量 time 中。\n使用 su ysb 切换到名为 ysb 的用户。\n使用 autossh 命令建立两个反向 SSH 隧道，将远程主机的 22 端口映射到本地的 50754 端口和远程主机的 8010 端口映射到本地的 50763 端口。这样可以实现对远程主机的安全访问。\n切换到 /srv/project/ 目录，并执行名为 start.sh 的脚本。\n将重启信息和日志记录到 /srv/project/restart.log 文件中。\n最后，脚本退出。\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);